<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<div layout:fragment="content">
  <h2>상품 목록</h2>

  <!-- 검색 폼 -->
  <form th:action="@{/items/search}" method="get" class="mb-3">
    <div class="input-group">
      <input type="text" name="keyword" class="form-control" placeholder="상품명으로 검색">
      <button type="submit" class="btn btn-primary">검색</button>
    </div>
  </form>

  <!-- 상품 테이블 -->
  <table class="table table-hover">
    <thead class="table-dark">
    <tr>
      <th>상품명</th>
      <th>가격</th>
      <th>재고</th>
      <th>카테고리</th>
      <th>상태</th>
      <th>액션</th>
    </tr>
    </thead>
    <tbody>
    <!-- 상품이 없는 경우 -->
    <tr th:if="${items == null or items.empty()}">
      <td colspan="6" class="text-center py-4">
        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
        <p class="text-muted">상품이 없습니다.</p>
      </td>
    </tr>

    <!-- 상품 목록 -->
    <tr th:each="item : ${items?.content}">
      <td th:text="${item.itemNm}">상품명</td>
      <td th:text="${#numbers.formatInteger(item.price, 0, 'COMMA')}">0</td>
      <td th:text="${item.stockNumber}">0</td>
      <td th:text="${item.category?.cateName}">카테고리</td>
      <td>
        <span th:text="${item.itemSellStatus}"
              th:classappend="${item.itemSellStatus == 'SELL'} ? 'badge bg-success' : 'badge bg-secondary'">
          상태
        </span>
      </td>
      <td>
        <a th:href="@{/items/{id}(id=${item.id})}"
           class="btn btn-sm btn-outline-primary me-1">상세</a>
        <a th:href="@{/items/{id}/edit(id=${item.id})}"
           class="btn btn-sm btn-outline-warning"
           sec:authorize="hasRole('ADMIN')">수정</a>
      </td>
    </tr>
    </tbody>
  </table>

  <!-- 페이징 (Pageable 객체 기준) -->
  <nav th:if="${items != null and !items.empty()}" aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      <!-- 이전 페이지 -->
      <li th:classappend="${!items.hasPrevious()} ? 'disabled'">
        <a th:href="@{/items(page=${items.number - 1})}"
           class="page-link" th:text="'« 이전'">이전</a>
      </li>

      <!-- 페이지 번호 -->
      <li th:each="i : ${#numbers.sequence(0, items.totalPages - 1)}"
          th:classappend="${i == items.number} ? 'active'">
        <a th:href="@{/items(page=${i})}"
           class="page-link"
           th:text="${i + 1}">1</a>
      </li>

      <!-- 다음 페이지 -->
      <li th:classappend="${!items.hasNext()} ? 'disabled'">
        <a th:href="@{/items(page=${items.number + 1})}"
           class="page-link" th:text="'다음 »'">다음</a>
      </li>
    </ul>

    <!-- 페이지 정보 -->
    <div class="text-center text-muted mt-2">
      총 <span th:text="${items.totalElements}"></span>개 (
      <span th:text="${items.number + 1}"></span> /
      <span th:text="${items.totalPages}"></span> 페이지 )
    </div>
  </nav>
</div>

</html>
